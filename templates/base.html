<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}MCB{% endblock %}</title>
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Materialize CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <!-- Global/Landing CSS (legacy + new path during migration) -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/landing/landing.css') }}">
    <!-- Modular CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/dashboard/dashboard.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/dashboard/applications.css') }}">
    {% block head %}{% endblock %}
</head>
<body class="{% if session.get('user') and request.endpoint not in ['home','login'] %}layout-dashboard{% endif %}">
    {# Global layout: show sidebar for any authenticated app pages (dashboard, applications, etc.) #}
    {% set use_sidebar = session.get('user') and request.endpoint not in ['home','login'] %}

    {% if not use_sidebar %}
        {% include 'partials/header.html' %}
    {% else %}
        {% include 'partials/sidebar.html' %}
    {% endif %}

    <main id="{{ 'dashboard-main' if use_sidebar else 'page-main' }}" class="{{ 'dashboard-main' if use_sidebar else 'page-main' }}">
        {% block content %}{% endblock %}
    </main>

    {% if not use_sidebar %}
        {% include 'partials/footer.html' %}
    {% endif %}

    <!-- jQuery (required for Materialize) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Materialize JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <!-- Initialize Materialize components -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check if we're on the dashboard
            const isDashboard = window.location.pathname === '/dashboard';
            if (isDashboard) {
                document.body.classList.add('dashboard-layout');
            }

            // Initialize sidenav
            var sidenavElems = document.querySelectorAll('.sidenav');
            var sidenavInstances = M.Sidenav.init(sidenavElems, {
                edge: 'left',
                draggable: true,
                preventScrolling: true
            });

            // For dashboard nav, ensure it stays open on large screens
            const dashboardNav = document.querySelector('.dashboard-nav');
            if (dashboardNav && window.innerWidth > 992) {
                M.Sidenav.getInstance(dashboardNav).open();
            }

            // Handle window resize for dashboard nav
            window.addEventListener('resize', function() {
                const dashboardNav = document.querySelector('.dashboard-nav');
                if (dashboardNav) {
                    const instance = M.Sidenav.getInstance(dashboardNav);
                    if (window.innerWidth > 992) {
                        instance.open();
                    } else {
                        instance.close();
                    }
                }
            });

            // Initialize dropdowns
            var dropdownElems = document.querySelectorAll('.dropdown-trigger');
            var dropdownInstances = M.Dropdown.init(dropdownElems, {
                coverTrigger: false,
                constrainWidth: false,
                alignment: 'right'
            });

            // Initialize tooltips
            var tooltipElems = document.querySelectorAll('.tooltipped');
            var tooltipInstances = M.Tooltip.init(tooltipElems);

            // Initialize toast close buttons
            var toastCloseButtons = document.querySelectorAll('.toast-action');
            toastCloseButtons.forEach(function(button) {
                button.addEventListener('click', function() {
                    this.closest('.card-panel').remove();
                });
            });

            // Handle active menu items
            if (isDashboard) {
                const currentPath = window.location.pathname;
                document.querySelectorAll('#dashboard-nav li a').forEach(link => {
                    if (link.getAttribute('href') === currentPath) {
                        link.parentElement.classList.add('active');
                    }
                });
            }
        });
    </script>
    {% block scripts %}{% endblock %}
</body>
</html>